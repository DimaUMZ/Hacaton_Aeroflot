Отличный запрос. Давайте детально разберем **Этап 1**, который является фундаментом всего проекта и ключом к успешной промежуточной сдаче.

### Этап 1: Прототипирование и проектирование архитектуры

Этот этап не о коде, а о планировании. Его цель — согласовать видение продукта между заказчиком, командой и стейкхолдерами, чтобы избежать дорогостоящих переделок на поздних этапах.

---

### 1. UX/UI-макет (Figma, Adobe XD)

Цель: Визуализировать логику взаимодействия пользователя с системой. Макеты (wireframes) должны быть интуитивно понятными и решать конкретные задачи пользователя, как того требует ТЗ.

**Пример описания ключевых экранов:**

#### a) Экран аутентификации / Выбор операции
*   **Цель:** Определить пользователя и тип выполняемой операции.
*   **Элементы:**
    *   Поле для ввода ID бейджа/логина.
    *   Поле для ввода пароля/PIN-кода.
    *   Две крупные кнопки: **«Получить инструмент»** и **«Сдать инструмент»**.
    *   *Пример: После сканирования пропуска инженера система автоматически определяет, какой комплект ему был выдан, и предлагает ему сдать его. Кнопка «Получить» ведет на следующий экран для выбора комплекта.*

#### b) Экран захвата ("Получение инструмента")
*   **Цель:** Зафиксировать выданный комплект.
*   **Элементы:**
    *   **Live-вид с камеры** на весь стол.
    *   Кнопка **«Захватить изображение»** (или автоматический захват по таймеру/по голосовой команде "Готово").
    *   Инструкция для пользователя: *«Разложите все инструменты из комплекта в поле зрения камеры и нажмите "Захватить"»*.
    *   После захвата — preview полученного снимка и кнопка **«Подтвердить»** или **«Переснять»**.
    *   Индикатор процесса: «Идет распознавание...».

#### c) Экран результатов ("Результаты приема/сдачи")
*   **Цель:** Показать результат работы алгоритма и запросить действие у пользователя.
*   **Элементы:**
    *   **Таблица/Список инструментов:**
        *   Колонка 1: **Иконка/фото инструмента**.
        *   Колонка 2: **Название инструмента** (e.g., "Отвертка '+'", "Пассатижи").
        *   Колонка 3: **Статус**: `Распознан`, `Не распознан`, `Не обнаружен`.
        *   Колонка 4: **Уверенность алгоритма** (e.g., 98%).
    *   **Круговой индикатор (Progress Circle)** с общим процентом совпадения (например, `95%`).
    *   **Визуальная индикация:**
        *   Зеленая галочка и надпись «Комплект полный» — если процент выше порогового (например, 95%).
        *   Желтый/Красный восклицательный знак и надпись «Обнаружены расхождения» — если процент ниже порогового.
    *   **Кнопки действий:**
        *   **«Подтвердить и завершить»** (активна при успешной проверке). Отправляет результат в систему ТОиР.
        *   **«Запустить ручной пересчет»** (активна при неудаче). Сигнализирует инспектору о проблеме и логирует инцидент.
    *   *Пример: Инженер сдает инструменты. Система показывает, что бокорезы распознаны с уверенностью 45%. Общий процент — 91%. Так как порог установлен на 95%, система подсвечивает предупреждение и предлагает инженеру переложить инструмент или запустить ручной пересчет.*

#### d) Экран истории операций
*   **Цель:** Показать аудиторский след.
*   **Элементы:**
    *   Таблица с колонками: **Дата/Время**, **Инженер**, **Тип операции** (Получение/Сдача), **Комплект**, **Результат (%)**, **Статус** (Успех/Расхождение).
    *   Фильтры по дате, инженеру, статусу.
    *   Клик на запись раскрывает детализацию (как на экране результатов).

---

### 2. Блок-схема архитектуры (Draw.io, Miro)

Цель: Показать, как все технические компоненты системы взаимодействуют друг с другом. Рекомендуется архитектура на основе микросервисов в контейнерах для гибкости и масштабируемости.

**Пример компонентов и их взаимодействия:**

```
+-------------------+     HTTP/HTTPS      +---------------------+    REST API     +-----------------------+
|                   | ------------------> |                     | --------------> |                       |
|   Web Browser     |                     |   Nginx (Reverse    |                 |   Backend (FastAPI)   |
|   (Frontend)      | <------------------ |     Proxy)          | <-------------  |                       |
|   React App       |                     +---------------------+                 +-----------|-----------+
+-------------------+                                                                         |
                                                                                              | (Взаимодействие с сервисами)
                                                                               +------------------------------+
                                                                               |                              |
                                                                   +-----------v-----------+    +-------------v-------------+
                                                                   |                       |    |                           |
                                                                   |   ML Service (Python) |    |   Database (PostgreSQL)   |
                                                                   |   - YOLO Model        |    |   - Logs                  |
                                                                   |   - OpenCV            |    |   - Users                 |
                                                                   |                       |    |   - Transaction History   |
                                                                   +-----------------------+    +---------------------------+
```

**Пояснение к компонентам:**

1.  **Frontend (Веб-интерфейс):** Статический SPA (Single Page Application), собранный в `HTML/CSS/JS`. Хостится на том же веб-сервере, что и бэкенд, или на CDN. **Не имеет прямой связи с БД или ML-сервисом.**
2.  **Nginx:** Выступает как единая точка входа.
    *   Перенаправляет запросы к `/api/...` на бэкенд-сервис.
    *   Отдает статические файлы фронтенда (папку `build/`) по корневому запросу `/`.
    *   Может кешировать запросы, балансировать нагрузку, обслуживать SSL.
3.  **Backend API (FastAPI):** "Мозг" приложения.
    *   Принимает запросы от фронтенда.
    *   **REST Endpoint:** `POST /api/recognize` — принимает изображение, вызывает ML-сервис, возвращает результат распознавания.
    *   **REST Endpoint:** `POST /api/confirm_operation` — сохраняет результат операции в БД.
    *   **REST Endpoint:** `GET /api/history` — отдает историю операций для UI.
    *   Аутентифицирует пользователей (JWT токены).
    *   Взаимодействует с БД через ORM.
4.  **ML Service:** Изолированный сервис на Python.
    *   Имеет один главный метод: `predict(image: bytes) -> List[Tool]`.
    *   Загружает обученную модель YOLO при старте.
    *   Использует OpenCV для препроцессинга изображения.
    *   Возвращает JSON с списком найденных инструментов, их координатами и уверенностью. Например:
        ```json
        {
          "tools_detected": [
            {"class": "screwdriver_plus", "confidence": 0.98},
            {"class": "wrench", "confidence": 0.92},
            {"class": "pliers", "confidence": 0.45}
          ]
        }
        ```
5.  **Database (PostgreSQL):** Хранит не изображения, а метаданные.
    *   **Таблица `users`:** ID, имя, хэш пароля.
    *   **Таблица `toolkits`:** Описание эталонных комплектов (какие инструменты и в каком количестве должны быть).
    *   **Таблица `operations`:** Лог всех выдач и сдач (user_id, toolkit_id, timestamp, result_json, status).

---

### 3. Стек технологий (Выбор и обоснование)

На этом шаге мы фиксируем выбор технологий, который будем использовать.

| Компонент | Выбор | Обоснование |
| :--- | :--- | :--- |
| **Frontend** | **React + TypeScript + Vite + MUI** | React — индустриальный стандарт с огромным сообществом. TypeScript повышает надежность и предотвращает ошибки. Vite — быстрый сборщик. MUI предоставляет готовые, профессионально выглядящие UI-компоненты, что ускоряет разработку. |
| **Backend** | **FastAPI (Python) + SQLAlchemy + PostgreSQL** | FastAPI — современный, очень быстрый фреймворк. **Ключевое преимущество:** автоматическая генерация **Swagger UI** (OpenAPI), что прямо требуется в ТЗ. SQLAlchemy — мощный ORM. PostgreSQL — надежная и популярная open-source БД. |
| **ML Service** | **YOLOv8 (Ultralytics) + OpenCV + FastAPI** | YOLOv8 — state-of-the-art модель для детекции объектов, проста в обучении и использовании. OpenCV — стандарт де-факто для работы с изображениями. Мы можем обернуть ML-логику в еще один микросервис на FastAPI для единообразия. |
| **Развертывание** | **Docker + Docker Compose** | **Прямое требование ТЗ.** Контейнеризация гарантирует, что приложение будет работать одинаково на любой системе (разработчика, тестовой, production). Позволяет легко масштабировать каждый сервис независимо. |
| **Документация** | **Swagger UI (автоиз FastAPI), MkDocs, Draw.io** | Swagger UI покроет требования к API. MkDocs — для красивой и простой документации в Markdown. Draw.io — для создания и экспорта схем архитектуры. |

**Итог по Этапу 1:**
На выходе промежуточной сдачи у вас будет:
1.  **Интерактивный прототип UI** в Figma, который можно показать заказчику и по которому можно начинать фронтенд-разработку.
2.  **Четкая схема архитектуры**, показывающая, как все части системы связаны друг с другом.
3.  **Документ с обоснованием выбора технологий**, который демонстриет продуманность технического подхода и соответствие требованиям ТЗ (open-source, контейнеризация, Swagger).

Этот фундамент позволит команде приступить к параллельной разработке всех компонентов системы без недопонимания.
